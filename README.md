# HLS Utils

HLS Utils is a lightweight HTTP Live Streaming (HLS) management server that provides functionalities to manage streams,
authenticate clients, and serve playlists generated by tools like ffmpeg with variant support. It supports
authentication for the _nginx-rtmp-module_, enables monitoring of subscribers for each stream, and sending notifications
when new streams start.

## Features

- **Stream Management**: Serve HLS playlists for multiple streams.
- **Authentication**: Securely authenticate clients using tokens.
- **Variant Support**: Serve different variants (e.g., audio tracks) of a stream.
- **Statistics**: Track the number of subscribers for each stream.
- **Notifications**: Send notifications to an external endpoint when a client authenticates.

## Requirements

To run the _HLS Utils_, ensure you have the following prerequisites:

- **Go**: Version 1.22 or higher is recommended.

## Installation

1. Open a command line interface on the target system.
2. Clone this repository:
   ```shell
   git clone <GIT_REPOSITORY>
   ```
3. Navigate to the cloned directory:
   ```shell
   cd hls-utils
   ```
4. Build the executable:
   ```shell
   go build -a -buildmode=exe -trimpath -ldflags="-s -w" -o hls-utils
   ```
5. Configure the service using `config.yaml`.
   The service will automatically look for this file in `/etc/hls-utils/config.yaml`
   or the current directory (`./config.yaml`).
   Alternatively, specify a custom path using the `--config <PATH>` option.
6. Start the server:
   ```shell
   ./hls-utils [--config <PATH>]
   ```

## Configuration

| YAML Parameter                    | Description                                                      | Default     |
|:----------------------------------|:-----------------------------------------------------------------|:------------|
| _log_level_                       | The logging level (`debug`, `info`, `warning`, `error`, `fatal`) | `debug`     |
| _http_server.host_                | The host address to bind to.                                     | `127.0.0.1` |
| _http_server.port_                | The port number to listen on.                                    | `8080`      |
| _http_server.base_path_           | Base path for the API endpoints.                                 | _(empty)_   |
| _http_server.cert_file_           | Path to SSL certificate file (for HTTPS).                        | _(empty)_   |
| _http_server.key_file_            | Path to SSL key file (for HTTPS).                                | _(empty)_   |
| _http_server.read_timeout_        | Timeout for reading requests.                                    | `30s`       |
| _http_server.read_header_timeout_ | Timeout for reading request headers.                             | `10s`       |
| _live_dir_                        | Directory where live HLS streams are stored.                     | `/tmp`      |
| _record_dir_                      | Directory where recorded streams are stored.                     | `/tmp`      |
| _statistic_rotation_interval_     | Interval at which statistics are rotated.                        | `10s`       |
| _notification_endpoint_           | URL to send notifications when a client authenticates.           | _(empty)_   |
| _track_labels_                    | map of labels for different tracks.                              | _(empty)_   |
| _streams_                         | Map of stream names to authentication tokens.                    | _(empty)_   |


### nginx

To integrate HLS Utils with `nginx-rtmp-module`, you need to configure your nginx server as follows:

```
rtmp {
    server {
        application stream {
            notify_method post;
            on_publish http://127.0.0.1:8081/auth;
        }
    }
}
```
